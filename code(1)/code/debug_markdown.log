2025-04-25 10:55:32,140 - INFO - NumExpr defaulting to 6 threads.
2025-04-25 10:55:32,469 - DEBUG - Environment variable FAISS_OPT_LEVEL is not set, so let's pick the instruction set according to the current CPU
2025-04-25 10:55:32,469 - INFO - Loading faiss with AVX2 support.
2025-04-25 10:55:32,489 - INFO - Successfully loaded faiss with AVX2 support.
2025-04-25 10:55:37,891 - DEBUG - 从 chat_history\latest_sessions.json 加载了聊天会话
2025-04-25 10:55:37,919 - INFO - Load pretrained SentenceTransformer: sentence-transformers/paraphrase-multilingual-mpnet-base-v2
2025-04-25 10:55:37,924 - DEBUG - Starting new HTTPS connection (1): huggingface.co:443
2025-04-25 10:55:38,332 - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/paraphrase-multilingual-mpnet-base-v2/resolve/main/modules.json HTTP/11" 200 0
2025-04-25 10:55:38,547 - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/paraphrase-multilingual-mpnet-base-v2/resolve/main/config_sentence_transformers.json HTTP/11" 200 0
2025-04-25 10:55:38,781 - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/paraphrase-multilingual-mpnet-base-v2/resolve/main/README.md HTTP/11" 200 0
2025-04-25 10:55:38,994 - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/paraphrase-multilingual-mpnet-base-v2/resolve/main/modules.json HTTP/11" 200 0
2025-04-25 10:55:39,322 - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/paraphrase-multilingual-mpnet-base-v2/resolve/main/sentence_bert_config.json HTTP/11" 200 0
2025-04-25 10:55:39,545 - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/paraphrase-multilingual-mpnet-base-v2/resolve/main/config.json HTTP/11" 200 0
2025-04-25 10:55:42,097 - DEBUG - https://huggingface.co:443 "HEAD /sentence-transformers/paraphrase-multilingual-mpnet-base-v2/resolve/main/tokenizer_config.json HTTP/11" 200 0
2025-04-25 10:55:43,189 - DEBUG - https://huggingface.co:443 "GET /api/models/sentence-transformers/paraphrase-multilingual-mpnet-base-v2/revision/main HTTP/11" 200 6288
2025-04-25 10:55:43,215 - INFO - Use pytorch device_name: cuda
2025-04-25 10:55:43,843 - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-04-25 10:55:43,843 - DEBUG - load_verify_locations cafile='D:\\anaconda3\\Lib\\site-packages\\certifi\\cacert.pem'
2025-04-25 10:55:44,175 - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-04-25 10:55:44,176 - DEBUG - load_verify_locations cafile='D:\\anaconda3\\Lib\\site-packages\\certifi\\cacert.pem'
2025-04-25 10:55:44,507 - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-04-25 10:55:44,508 - DEBUG - load_verify_locations cafile='D:\\anaconda3\\Lib\\site-packages\\certifi\\cacert.pem'
2025-04-25 10:55:44,852 - DEBUG - 开始显示历史消息: 消息数量=10
2025-04-25 10:55:44,852 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:55:44,852 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:55:44,853 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:55:44,854 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:55:44,854 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:55:44,854 - DEBUG - 预处理前的原始Markdown文本长度: 540
2025-04-25 10:55:44,854 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a) 对液压系统进行排故时，只需针对存在问题的系统（A、B 或备用）执行相关程序。如条件允许，应使用标...
...
b) 若液压油泄漏率未超限，则继续后续检查。  

(2) 执行液压系统内部泄漏检查（参照AMM PAGEBLOCK 29-00-00/601）。  
(a) 若液压油泄漏率超出内部泄漏限制，则修复泄漏原因。  

（注：技术术语如AMM TASK/PAGEBLOCK编号、系统名称等均保留原文格式）
2025-04-25 10:55:44,854 - DEBUG - 预处理后的文本长度: 540
2025-04-25 10:55:44,855 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=540, 新长度=540)
2025-04-25 10:55:44,855 - WARNING - 历史消息可能缺少Markdown格式: A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a...
2025-04-25 10:55:44,855 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:55:44,855 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:55:44,856 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:55:44,857 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:55:44,857 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:55:44,857 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:55:44,857 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:55:44,858 - DEBUG - 预处理前的原始Markdown文本长度: 540
2025-04-25 10:55:44,858 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a) 对液压系统进行排故时，只需针对存在问题的系统（A、B 或备用）执行相关程序。如条件允许，应使用标...
...
b) 若液压油泄漏率未超限，则继续后续检查。  

(2) 执行液压系统内部泄漏检查（参照AMM PAGEBLOCK 29-00-00/601）。  
(a) 若液压油泄漏率超出内部泄漏限制，则修复泄漏原因。  

（注：技术术语如AMM TASK/PAGEBLOCK编号、系统名称等均保留原文格式）
2025-04-25 10:55:44,858 - DEBUG - 预处理后的文本长度: 540
2025-04-25 10:55:44,858 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=540, 新长度=540)
2025-04-25 10:55:44,858 - WARNING - 历史消息可能缺少Markdown格式: A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a...
2025-04-25 10:55:44,858 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:55:44,858 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:55:44,859 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:55:44,860 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:55:44,860 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:55:44,861 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:55:44,861 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:55:44,861 - DEBUG - 预处理前的原始Markdown文本长度: 1437
2025-04-25 10:55:44,861 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good condition. It will
help you to find which parts a...
...
eck (AMM PAGEBLOCK 29-00-00/601).
(a) If the hydraulic fluid leakage rate is more than the internal leakage limits, then repair the
cause of the leak.
2025-04-25 10:55:44,861 - DEBUG - 预处理后的文本长度: 1437
2025-04-25 10:55:44,861 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=1437, 新长度=1437)
2025-04-25 10:55:44,861 - WARNING - 历史消息可能缺少Markdown格式: A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good...
2025-04-25 10:55:44,861 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:55:44,861 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:55:44,862 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:55:44,863 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:55:44,864 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:55:44,865 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:55:44,865 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:55:44,865 - DEBUG - 预处理前的原始Markdown文本长度: 1437
2025-04-25 10:55:44,865 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good condition. It will
help you to find which parts a...
...
eck (AMM PAGEBLOCK 29-00-00/601).
(a) If the hydraulic fluid leakage rate is more than the internal leakage limits, then repair the
cause of the leak.
2025-04-25 10:55:44,865 - DEBUG - 预处理后的文本长度: 1437
2025-04-25 10:55:44,865 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=1437, 新长度=1437)
2025-04-25 10:55:44,865 - WARNING - 历史消息可能缺少Markdown格式: A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good...
2025-04-25 10:55:44,866 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:55:44,867 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:55:44,867 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:55:44,867 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:55:44,869 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:55:44,869 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:55:44,870 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:55:44,870 - DEBUG - 预处理前的原始Markdown文本长度: 1573
2025-04-25 10:55:44,871 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发油液溢出。  
1) **若飞机到达停机坪时地面环境温度为20华氏度（-6.7摄氏度）或更低**，建...
...
统B向A串流，执行<a href="/?task=29-10-807" class="task-link">29-10 TASK 807</a>《B→A串流故障隔离》  
(c) 重新增压（同上）  
(d) 无油液渗出则故障排除，执行：  
1) AMM TASK 29-11-00-860-805
2025-04-25 10:55:44,871 - DEBUG - 转换任务引用: 29-10 TASK 806 -> HTML链接
2025-04-25 10:55:44,871 - DEBUG - 转换任务引用: 29-10 TASK 807 -> HTML链接
2025-04-25 10:55:44,871 - DEBUG - 转换HTML任务链接: <a>...</a> -> 自定义HTML链接
2025-04-25 10:55:44,871 - DEBUG - 转换HTML任务链接: <a>...</a> -> 自定义HTML链接
2025-04-25 10:55:44,871 - DEBUG - 预处理后的文本长度: 1671
2025-04-25 10:55:44,871 - DEBUG - 历史消息格式化: 长度变化=98 (原长度=1573, 新长度=1671)
2025-04-25 10:55:44,871 - WARNING - 历史消息可能缺少Markdown格式: A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发...
2025-04-25 10:55:44,872 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:55:44,872 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:00,203 - DEBUG - 开始显示历史消息: 消息数量=10
2025-04-25 10:56:00,203 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:00,204 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:00,204 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:00,205 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:00,205 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:00,205 - DEBUG - 预处理前的原始Markdown文本长度: 540
2025-04-25 10:56:00,205 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a) 对液压系统进行排故时，只需针对存在问题的系统（A、B 或备用）执行相关程序。如条件允许，应使用标...
...
b) 若液压油泄漏率未超限，则继续后续检查。  

(2) 执行液压系统内部泄漏检查（参照AMM PAGEBLOCK 29-00-00/601）。  
(a) 若液压油泄漏率超出内部泄漏限制，则修复泄漏原因。  

（注：技术术语如AMM TASK/PAGEBLOCK编号、系统名称等均保留原文格式）
2025-04-25 10:56:00,205 - DEBUG - 预处理后的文本长度: 540
2025-04-25 10:56:00,205 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=540, 新长度=540)
2025-04-25 10:56:00,205 - WARNING - 历史消息可能缺少Markdown格式: A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a...
2025-04-25 10:56:00,206 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:00,206 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:00,207 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:00,208 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:00,208 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:00,209 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:00,210 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:00,210 - DEBUG - 预处理前的原始Markdown文本长度: 540
2025-04-25 10:56:00,210 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a) 对液压系统进行排故时，只需针对存在问题的系统（A、B 或备用）执行相关程序。如条件允许，应使用标...
...
b) 若液压油泄漏率未超限，则继续后续检查。  

(2) 执行液压系统内部泄漏检查（参照AMM PAGEBLOCK 29-00-00/601）。  
(a) 若液压油泄漏率超出内部泄漏限制，则修复泄漏原因。  

（注：技术术语如AMM TASK/PAGEBLOCK编号、系统名称等均保留原文格式）
2025-04-25 10:56:00,210 - DEBUG - 预处理后的文本长度: 540
2025-04-25 10:56:00,210 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=540, 新长度=540)
2025-04-25 10:56:00,210 - WARNING - 历史消息可能缺少Markdown格式: A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a...
2025-04-25 10:56:00,211 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:00,211 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:00,212 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:00,214 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:00,215 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:00,216 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:00,216 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:00,216 - DEBUG - 预处理前的原始Markdown文本长度: 1437
2025-04-25 10:56:00,217 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good condition. It will
help you to find which parts a...
...
eck (AMM PAGEBLOCK 29-00-00/601).
(a) If the hydraulic fluid leakage rate is more than the internal leakage limits, then repair the
cause of the leak.
2025-04-25 10:56:00,217 - DEBUG - 预处理后的文本长度: 1437
2025-04-25 10:56:00,217 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=1437, 新长度=1437)
2025-04-25 10:56:00,217 - WARNING - 历史消息可能缺少Markdown格式: A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good...
2025-04-25 10:56:00,218 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:00,218 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:00,219 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:00,219 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:00,220 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:00,221 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:00,221 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:00,221 - DEBUG - 预处理前的原始Markdown文本长度: 1437
2025-04-25 10:56:00,221 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good condition. It will
help you to find which parts a...
...
eck (AMM PAGEBLOCK 29-00-00/601).
(a) If the hydraulic fluid leakage rate is more than the internal leakage limits, then repair the
cause of the leak.
2025-04-25 10:56:00,221 - DEBUG - 预处理后的文本长度: 1437
2025-04-25 10:56:00,221 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=1437, 新长度=1437)
2025-04-25 10:56:00,221 - WARNING - 历史消息可能缺少Markdown格式: A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good...
2025-04-25 10:56:00,222 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:00,222 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:00,223 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:00,224 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:00,225 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:00,225 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:00,225 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:00,225 - DEBUG - 预处理前的原始Markdown文本长度: 1573
2025-04-25 10:56:00,226 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发油液溢出。  
1) **若飞机到达停机坪时地面环境温度为20华氏度（-6.7摄氏度）或更低**，建...
...
统B向A串流，执行<a href="/?task=29-10-807" class="task-link">29-10 TASK 807</a>《B→A串流故障隔离》  
(c) 重新增压（同上）  
(d) 无油液渗出则故障排除，执行：  
1) AMM TASK 29-11-00-860-805
2025-04-25 10:56:00,226 - DEBUG - 转换任务引用: 29-10 TASK 806 -> HTML链接
2025-04-25 10:56:00,226 - DEBUG - 转换任务引用: 29-10 TASK 807 -> HTML链接
2025-04-25 10:56:00,226 - DEBUG - 转换HTML任务链接: <a>...</a> -> 自定义HTML链接
2025-04-25 10:56:00,226 - DEBUG - 转换HTML任务链接: <a>...</a> -> 自定义HTML链接
2025-04-25 10:56:00,226 - DEBUG - 预处理后的文本长度: 1671
2025-04-25 10:56:00,226 - DEBUG - 历史消息格式化: 长度变化=98 (原长度=1573, 新长度=1671)
2025-04-25 10:56:00,226 - WARNING - 历史消息可能缺少Markdown格式: A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发...
2025-04-25 10:56:00,227 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:00,227 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:01,892 - DEBUG - 开始显示历史消息: 消息数量=10
2025-04-25 10:56:01,893 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:01,893 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:01,894 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:01,894 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:01,894 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:01,894 - DEBUG - 预处理前的原始Markdown文本长度: 540
2025-04-25 10:56:01,894 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a) 对液压系统进行排故时，只需针对存在问题的系统（A、B 或备用）执行相关程序。如条件允许，应使用标...
...
b) 若液压油泄漏率未超限，则继续后续检查。  

(2) 执行液压系统内部泄漏检查（参照AMM PAGEBLOCK 29-00-00/601）。  
(a) 若液压油泄漏率超出内部泄漏限制，则修复泄漏原因。  

（注：技术术语如AMM TASK/PAGEBLOCK编号、系统名称等均保留原文格式）
2025-04-25 10:56:01,894 - DEBUG - 预处理后的文本长度: 540
2025-04-25 10:56:01,895 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=540, 新长度=540)
2025-04-25 10:56:01,895 - WARNING - 历史消息可能缺少Markdown格式: A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a...
2025-04-25 10:56:01,895 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:01,895 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:01,897 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:01,898 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:01,898 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:01,899 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:01,899 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:01,899 - DEBUG - 预处理前的原始Markdown文本长度: 540
2025-04-25 10:56:01,899 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a) 对液压系统进行排故时，只需针对存在问题的系统（A、B 或备用）执行相关程序。如条件允许，应使用标...
...
b) 若液压油泄漏率未超限，则继续后续检查。  

(2) 执行液压系统内部泄漏检查（参照AMM PAGEBLOCK 29-00-00/601）。  
(a) 若液压油泄漏率超出内部泄漏限制，则修复泄漏原因。  

（注：技术术语如AMM TASK/PAGEBLOCK编号、系统名称等均保留原文格式）
2025-04-25 10:56:01,899 - DEBUG - 预处理后的文本长度: 540
2025-04-25 10:56:01,899 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=540, 新长度=540)
2025-04-25 10:56:01,899 - WARNING - 历史消息可能缺少Markdown格式: A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a...
2025-04-25 10:56:01,900 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:01,900 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:01,901 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:01,902 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:01,903 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:01,903 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:01,904 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:01,904 - DEBUG - 预处理前的原始Markdown文本长度: 1437
2025-04-25 10:56:01,904 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good condition. It will
help you to find which parts a...
...
eck (AMM PAGEBLOCK 29-00-00/601).
(a) If the hydraulic fluid leakage rate is more than the internal leakage limits, then repair the
cause of the leak.
2025-04-25 10:56:01,904 - DEBUG - 预处理后的文本长度: 1437
2025-04-25 10:56:01,904 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=1437, 新长度=1437)
2025-04-25 10:56:01,904 - WARNING - 历史消息可能缺少Markdown格式: A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good...
2025-04-25 10:56:01,905 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:01,905 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:01,907 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:01,907 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:01,909 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:01,909 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:01,909 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:01,910 - DEBUG - 预处理前的原始Markdown文本长度: 1437
2025-04-25 10:56:01,911 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good condition. It will
help you to find which parts a...
...
eck (AMM PAGEBLOCK 29-00-00/601).
(a) If the hydraulic fluid leakage rate is more than the internal leakage limits, then repair the
cause of the leak.
2025-04-25 10:56:01,912 - DEBUG - 预处理后的文本长度: 1437
2025-04-25 10:56:01,912 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=1437, 新长度=1437)
2025-04-25 10:56:01,912 - WARNING - 历史消息可能缺少Markdown格式: A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good...
2025-04-25 10:56:01,912 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:01,912 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:01,913 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:01,913 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:01,913 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:01,914 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:01,914 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:01,914 - DEBUG - 预处理前的原始Markdown文本长度: 1573
2025-04-25 10:56:01,914 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发油液溢出。  
1) **若飞机到达停机坪时地面环境温度为20华氏度（-6.7摄氏度）或更低**，建...
...
统B向A串流，执行<a href="/?task=29-10-807" class="task-link">29-10 TASK 807</a>《B→A串流故障隔离》  
(c) 重新增压（同上）  
(d) 无油液渗出则故障排除，执行：  
1) AMM TASK 29-11-00-860-805
2025-04-25 10:56:01,915 - DEBUG - 转换任务引用: 29-10 TASK 806 -> HTML链接
2025-04-25 10:56:01,915 - DEBUG - 转换任务引用: 29-10 TASK 807 -> HTML链接
2025-04-25 10:56:01,915 - DEBUG - 转换HTML任务链接: <a>...</a> -> 自定义HTML链接
2025-04-25 10:56:01,915 - DEBUG - 转换HTML任务链接: <a>...</a> -> 自定义HTML链接
2025-04-25 10:56:01,915 - DEBUG - 预处理后的文本长度: 1671
2025-04-25 10:56:01,915 - DEBUG - 历史消息格式化: 长度变化=98 (原长度=1573, 新长度=1671)
2025-04-25 10:56:01,915 - WARNING - 历史消息可能缺少Markdown格式: A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发...
2025-04-25 10:56:01,917 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:01,917 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:01,923 - DEBUG - 聊天会话已保存到: chat_history\chat_sessions_1745549761.json
2025-04-25 10:56:01,928 - DEBUG - 从RAG pipeline获取的原始响应长度: 1475
2025-04-25 10:56:01,928 - DEBUG - 响应前100字符: A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发...
2025-04-25 10:56:01,928 - DEBUG - 响应包含Markdown格式检查: False
2025-04-25 10:56:01,928 - DEBUG - 响应原始内容:
A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发油液溢出。  
1) **若飞机到达停机坪时地面环境温度为20华氏度（-6.7摄氏度）或更低**，建议仅将油箱加注至略高于"REFILL"（再填充线）――满足放行要求的最低油量（AMM TASK 12-12-00-610-801）。  

B. 可能原因  
(1) 油箱过量加注  
(2) 安全活门故障  
(3) 液压油量传感器/指示器 T436 或 T184  
CEA 077, 078, 166, 169 PRE SB 737-29-1106  
(4) 油箱增压系统  
CEA ALL  
(5) 液压油串流  

C. 故障隔离程序  
(1) 检查液压系统A和B油箱油位：  
(a) 若油位超过"FULL"标记：  
1) 执行放油操作，参照AMM TASK 12-12-00-610-801《液压油箱勤务》  
2) 对相应油箱增压（任选其一）：  
   \u2022 AMM TASK 29-09-00-860-801《液压油箱增压》  
   \u2022 AMM TASK 29-09-00-860-807《液压油箱增压》  
3) 若油箱通气管/排放杆无油液渗出，则故障已排除，执行：  
   a) AMM TASK 29-11-00-860-805《液压系统A/B动力切断》  
(b) 若油位未超限则继续排查  

(2) 检查安全活门：  
(a) 对相应油箱增压（同上）  
(b) 监听对应安全活门工作声响  
(c) 若活门未在60-65 psi区间开启：  
1) 更换安全活门  
2) 重新增压（同上）  
3) 无油液渗出则故障排除，执行：  
   a) AMM TASK 29-11-00-860-805  
(d) 若活门工作正常则继续  

(3) 检查油量传感器/指示器（AMM TASK 29-33-12-200-801）：  
(a) 若传感器异常：  
1) 更换T436或T184传感器：  
   \u2022 拆卸AMM TASK 29-33-12-000-801  
   \u2022 安装AMM TASK 29-33-12-400-801  
2) 重新增压（同上）  
3) 无油液渗出则故障排除，执行：  
   a) AMM TASK 29-11-00-860-805  
(b) 若传感器正常则继续  
CEA 077, 078, 166, 169 PRE SB 737-29-1106  

(4) 检查油箱增压模块：  
(a) 确认通气帽无堵塞（AMM TASK 29-09-06-211-801）  
(b) 若存在堵塞：  
1) 执行AMM TASK 29-09-00-860-807增压  
2) 无油液渗出则故障排除，执行：  
   a) AMM TASK 29-11-00-860-805  
(c) 若通气帽正常则继续  
CEA ALL  

(5) 检查液压油串流：  
(a) 若系统A向B串流，执行29-10 TASK 806《A→B串流故障隔离》  
(b) 若系统B向A串流，执行29-10 TASK 807《B→A串流故障隔离》  
(c) 重新增压（同上）  
(d) 无油液渗出则故障排除，执行：  
1) AMM TASK 29-11-00-860-805
2025-04-25 10:56:01,929 - WARNING - 响应可能缺少Markdown格式，尝试增强格式化
2025-04-25 10:56:01,929 - DEBUG - 增强格式化后的文本: A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发...
2025-04-25 10:56:01,929 - DEBUG - 检索到 1 个来源文档
2025-04-25 10:56:01,930 - DEBUG - 预处理前的原始Markdown文本长度: 1475
2025-04-25 10:56:01,930 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发油液溢出。  
1) **若飞机到达停机坪时地面环境温度为20华氏度（-6.7摄氏度）或更低**，建...
...
(a) 若系统A向B串流，执行29-10 TASK 806《A→B串流故障隔离》  
(b) 若系统B向A串流，执行29-10 TASK 807《B→A串流故障隔离》  
(c) 重新增压（同上）  
(d) 无油液渗出则故障排除，执行：  
1) AMM TASK 29-11-00-860-805
2025-04-25 10:56:01,930 - DEBUG - 转换任务引用: 29-10 TASK 806 -> HTML链接
2025-04-25 10:56:01,930 - DEBUG - 转换任务引用: 29-10 TASK 807 -> HTML链接
2025-04-25 10:56:01,930 - DEBUG - 转换HTML任务链接: <a>...</a> -> 自定义HTML链接
2025-04-25 10:56:01,930 - DEBUG - 转换HTML任务链接: <a>...</a> -> 自定义HTML链接
2025-04-25 10:56:01,930 - DEBUG - 预处理后的文本长度: 1573
2025-04-25 10:56:01,930 - DEBUG - Markdown元素检查: 标题=False, 代码=False, 列表=False
2025-04-25 10:56:01,930 - DEBUG - 支持write_stream流式输出: True
2025-04-25 10:56:01,930 - DEBUG - 开始流式输出...
2025-04-25 10:56:01,931 - DEBUG - 流式输出: 总行数 = 61
2025-04-25 10:56:01,931 - DEBUG - 流式输出: 生成段落(长度=218)
2025-04-25 10:56:02,013 - DEBUG - 流式输出: 生成段落(长度=145)
2025-04-25 10:56:02,094 - DEBUG - 流式输出: 生成段落(长度=301)
2025-04-25 10:56:02,175 - DEBUG - 流式输出: 生成段落(长度=174)
2025-04-25 10:56:02,256 - DEBUG - 流式输出: 生成段落(长度=279)
2025-04-25 10:56:02,338 - DEBUG - 流式输出: 生成段落(长度=186)
2025-04-25 10:56:02,418 - DEBUG - 流式输出: 生成最后段落(长度=264)
2025-04-25 10:56:02,419 - DEBUG - 流式输出完成，使用markdown渲染最终内容
2025-04-25 10:56:02,419 - DEBUG - 最终渲染: 使用完整格式化内容
2025-04-25 10:56:02,420 - DEBUG - 会话ID: 2911512629072
2025-04-25 10:56:02,420 - DEBUG - 会话中的消息数量: 11
2025-04-25 10:56:02,422 - DEBUG - 更新会话历史: 添加助手回复
2025-04-25 10:56:02,422 - DEBUG - 添加到历史的消息长度: 1573
2025-04-25 10:56:02,423 - DEBUG - 添加到历史的来源数量: 1
2025-04-25 10:56:02,423 - DEBUG - 更新前会话消息数量: 11
2025-04-25 10:56:02,423 - DEBUG - 会话更新完成，当前消息数: 12
2025-04-25 10:56:02,426 - DEBUG - 聊天会话已保存到: chat_history\chat_sessions_1745549762.json
2025-04-25 10:56:02,426 - DEBUG - 会话最后消息摘要: A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发...
2025-04-25 10:56:02,426 - WARNING - 消息 #5 可能缺少Markdown格式 (长度=1437)
2025-04-25 10:56:02,426 - WARNING - 消息 #7 可能缺少Markdown格式 (长度=1437)
2025-04-25 10:56:02,427 - WARNING - 检测到会话历史中存在格式不一致的消息
2025-04-25 10:56:11,778 - DEBUG - 开始显示历史消息: 消息数量=12
2025-04-25 10:56:11,778 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:11,779 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:11,779 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:11,779 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:11,780 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:11,780 - DEBUG - 预处理前的原始Markdown文本长度: 540
2025-04-25 10:56:11,780 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a) 对液压系统进行排故时，只需针对存在问题的系统（A、B 或备用）执行相关程序。如条件允许，应使用标...
...
b) 若液压油泄漏率未超限，则继续后续检查。  

(2) 执行液压系统内部泄漏检查（参照AMM PAGEBLOCK 29-00-00/601）。  
(a) 若液压油泄漏率超出内部泄漏限制，则修复泄漏原因。  

（注：技术术语如AMM TASK/PAGEBLOCK编号、系统名称等均保留原文格式）
2025-04-25 10:56:11,780 - DEBUG - 预处理后的文本长度: 540
2025-04-25 10:56:11,780 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=540, 新长度=540)
2025-04-25 10:56:11,780 - WARNING - 历史消息可能缺少Markdown格式: A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a...
2025-04-25 10:56:11,781 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:11,781 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:11,782 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:11,782 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:11,782 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:11,783 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:11,783 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:11,783 - DEBUG - 预处理前的原始Markdown文本长度: 540
2025-04-25 10:56:11,783 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a) 对液压系统进行排故时，只需针对存在问题的系统（A、B 或备用）执行相关程序。如条件允许，应使用标...
...
b) 若液压油泄漏率未超限，则继续后续检查。  

(2) 执行液压系统内部泄漏检查（参照AMM PAGEBLOCK 29-00-00/601）。  
(a) 若液压油泄漏率超出内部泄漏限制，则修复泄漏原因。  

（注：技术术语如AMM TASK/PAGEBLOCK编号、系统名称等均保留原文格式）
2025-04-25 10:56:11,783 - DEBUG - 预处理后的文本长度: 540
2025-04-25 10:56:11,783 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=540, 新长度=540)
2025-04-25 10:56:11,784 - WARNING - 历史消息可能缺少Markdown格式: A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助识别磨损部件。  
(2) 此程序可用于判断部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a...
2025-04-25 10:56:11,784 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:11,784 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:11,785 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:11,785 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:11,787 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:11,787 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:11,787 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:11,787 - DEBUG - 预处理前的原始Markdown文本长度: 1437
2025-04-25 10:56:11,787 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good condition. It will
help you to find which parts a...
...
eck (AMM PAGEBLOCK 29-00-00/601).
(a) If the hydraulic fluid leakage rate is more than the internal leakage limits, then repair the
cause of the leak.
2025-04-25 10:56:11,788 - DEBUG - 预处理后的文本长度: 1437
2025-04-25 10:56:11,788 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=1437, 新长度=1437)
2025-04-25 10:56:11,788 - WARNING - 历史消息可能缺少Markdown格式: A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good...
2025-04-25 10:56:11,789 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:11,789 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:11,790 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:11,790 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:11,791 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:11,791 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:11,791 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:11,791 - DEBUG - 预处理前的原始Markdown文本长度: 1437
2025-04-25 10:56:11,792 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good condition. It will
help you to find which parts a...
...
eck (AMM PAGEBLOCK 29-00-00/601).
(a) If the hydraulic fluid leakage rate is more than the internal leakage limits, then repair the
cause of the leak.
2025-04-25 10:56:11,792 - DEBUG - 预处理后的文本长度: 1437
2025-04-25 10:56:11,792 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=1437, 新长度=1437)
2025-04-25 10:56:11,792 - WARNING - 历史消息可能缺少Markdown格式: A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good...
2025-04-25 10:56:11,792 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:11,792 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:11,794 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:11,794 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:11,795 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:11,795 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:11,795 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:11,795 - DEBUG - 预处理前的原始Markdown文本长度: 1573
2025-04-25 10:56:11,795 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发油液溢出。  
1) **若飞机到达停机坪时地面环境温度为20华氏度（-6.7摄氏度）或更低**，建...
...
统B向A串流，执行<a href="/?task=29-10-807" class="task-link">29-10 TASK 807</a>《B→A串流故障隔离》  
(c) 重新增压（同上）  
(d) 无油液渗出则故障排除，执行：  
1) AMM TASK 29-11-00-860-805
2025-04-25 10:56:11,796 - DEBUG - 转换任务引用: 29-10 TASK 806 -> HTML链接
2025-04-25 10:56:11,796 - DEBUG - 转换任务引用: 29-10 TASK 807 -> HTML链接
2025-04-25 10:56:11,796 - DEBUG - 转换HTML任务链接: <a>...</a> -> 自定义HTML链接
2025-04-25 10:56:11,796 - DEBUG - 转换HTML任务链接: <a>...</a> -> 自定义HTML链接
2025-04-25 10:56:11,796 - DEBUG - 预处理后的文本长度: 1671
2025-04-25 10:56:11,796 - DEBUG - 历史消息格式化: 长度变化=98 (原长度=1573, 新长度=1671)
2025-04-25 10:56:11,796 - WARNING - 历史消息可能缺少Markdown格式: A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发...
2025-04-25 10:56:11,797 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:11,797 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:11,798 - DEBUG - 显示历史消息: 角色=user
2025-04-25 10:56:11,799 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 10:56:11,800 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 10:56:11,800 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 10:56:11,800 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 10:56:11,800 - DEBUG - 预处理前的原始Markdown文本长度: 1573
2025-04-25 10:56:11,801 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发油液溢出。  
1) **若飞机到达停机坪时地面环境温度为20华氏度（-6.7摄氏度）或更低**，建...
...
统B向A串流，执行<a href="/?task=29-10-807" class="task-link">29-10 TASK 807</a>《B→A串流故障隔离》  
(c) 重新增压（同上）  
(d) 无油液渗出则故障排除，执行：  
1) AMM TASK 29-11-00-860-805
2025-04-25 10:56:11,801 - DEBUG - 转换任务引用: 29-10 TASK 806 -> HTML链接
2025-04-25 10:56:11,801 - DEBUG - 转换任务引用: 29-10 TASK 807 -> HTML链接
2025-04-25 10:56:11,801 - DEBUG - 转换HTML任务链接: <a>...</a> -> 自定义HTML链接
2025-04-25 10:56:11,802 - DEBUG - 转换HTML任务链接: <a>...</a> -> 自定义HTML链接
2025-04-25 10:56:11,802 - DEBUG - 预处理后的文本长度: 1671
2025-04-25 10:56:11,802 - DEBUG - 历史消息格式化: 长度变化=98 (原长度=1573, 新长度=1671)
2025-04-25 10:56:11,802 - WARNING - 历史消息可能缺少Markdown格式: A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发...
2025-04-25 10:56:11,803 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 10:56:11,805 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 10:56:11,814 - DEBUG - 聊天会话已保存到: chat_history\chat_sessions_1745549771.json
2025-04-25 10:56:11,816 - DEBUG - 从RAG pipeline获取的原始响应长度: 1475
2025-04-25 10:56:11,816 - DEBUG - 响应前100字符: A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发...
2025-04-25 10:56:11,817 - DEBUG - 响应包含Markdown格式检查: False
2025-04-25 10:56:11,817 - DEBUG - 响应原始内容:
A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发油液溢出。  
1) **若飞机到达停机坪时地面环境温度为20华氏度（-6.7摄氏度）或更低**，建议仅将油箱加注至略高于"REFILL"（再填充线）――满足放行要求的最低油量（AMM TASK 12-12-00-610-801）。  

B. 可能原因  
(1) 油箱过量加注  
(2) 安全活门故障  
(3) 液压油量传感器/指示器 T436 或 T184  
CEA 077, 078, 166, 169 PRE SB 737-29-1106  
(4) 油箱增压系统  
CEA ALL  
(5) 液压油串流  

C. 故障隔离程序  
(1) 检查液压系统A和B油箱油位：  
(a) 若油位超过"FULL"标记：  
1) 执行放油操作，参照AMM TASK 12-12-00-610-801《液压油箱勤务》  
2) 对相应油箱增压（任选其一）：  
   \u2022 AMM TASK 29-09-00-860-801《液压油箱增压》  
   \u2022 AMM TASK 29-09-00-860-807《液压油箱增压》  
3) 若油箱通气管/排放杆无油液渗出，则故障已排除，执行：  
   a) AMM TASK 29-11-00-860-805《液压系统A/B动力切断》  
(b) 若油位未超限则继续排查  

(2) 检查安全活门：  
(a) 对相应油箱增压（同上）  
(b) 监听对应安全活门工作声响  
(c) 若活门未在60-65 psi区间开启：  
1) 更换安全活门  
2) 重新增压（同上）  
3) 无油液渗出则故障排除，执行：  
   a) AMM TASK 29-11-00-860-805  
(d) 若活门工作正常则继续  

(3) 检查油量传感器/指示器（AMM TASK 29-33-12-200-801）：  
(a) 若传感器异常：  
1) 更换T436或T184传感器：  
   \u2022 拆卸AMM TASK 29-33-12-000-801  
   \u2022 安装AMM TASK 29-33-12-400-801  
2) 重新增压（同上）  
3) 无油液渗出则故障排除，执行：  
   a) AMM TASK 29-11-00-860-805  
(b) 若传感器正常则继续  
CEA 077, 078, 166, 169 PRE SB 737-29-1106  

(4) 检查油箱增压模块：  
(a) 确认通气帽无堵塞（AMM TASK 29-09-06-211-801）  
(b) 若存在堵塞：  
1) 执行AMM TASK 29-09-00-860-807增压  
2) 无油液渗出则故障排除，执行：  
   a) AMM TASK 29-11-00-860-805  
(c) 若通气帽正常则继续  
CEA ALL  

(5) 检查液压油串流：  
(a) 若系统A向B串流，执行29-10 TASK 806《A→B串流故障隔离》  
(b) 若系统B向A串流，执行29-10 TASK 807《B→A串流故障隔离》  
(c) 重新增压（同上）  
(d) 无油液渗出则故障排除，执行：  
1) AMM TASK 29-11-00-860-805
2025-04-25 10:56:11,817 - WARNING - 响应可能缺少Markdown格式，尝试增强格式化
2025-04-25 10:56:11,818 - DEBUG - 增强格式化后的文本: A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发...
2025-04-25 10:56:11,818 - DEBUG - 检索到 1 个来源文档
2025-04-25 10:56:11,819 - DEBUG - 预处理前的原始Markdown文本长度: 1475
2025-04-25 10:56:11,819 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发油液溢出。  
1) **若飞机到达停机坪时地面环境温度为20华氏度（-6.7摄氏度）或更低**，建...
...
(a) 若系统A向B串流，执行29-10 TASK 806《A→B串流故障隔离》  
(b) 若系统B向A串流，执行29-10 TASK 807《B→A串流故障隔离》  
(c) 重新增压（同上）  
(d) 无油液渗出则故障排除，执行：  
1) AMM TASK 29-11-00-860-805
2025-04-25 10:56:11,819 - DEBUG - 转换任务引用: 29-10 TASK 806 -> HTML链接
2025-04-25 10:56:11,819 - DEBUG - 转换任务引用: 29-10 TASK 807 -> HTML链接
2025-04-25 10:56:11,819 - DEBUG - 转换HTML任务链接: <a>...</a> -> 自定义HTML链接
2025-04-25 10:56:11,819 - DEBUG - 转换HTML任务链接: <a>...</a> -> 自定义HTML链接
2025-04-25 10:56:11,819 - DEBUG - 预处理后的文本长度: 1573
2025-04-25 10:56:11,819 - DEBUG - Markdown元素检查: 标题=False, 代码=False, 列表=False
2025-04-25 10:56:11,820 - DEBUG - 支持write_stream流式输出: True
2025-04-25 10:56:11,820 - DEBUG - 开始流式输出...
2025-04-25 10:56:11,820 - DEBUG - 流式输出: 总行数 = 61
2025-04-25 10:56:11,820 - DEBUG - 流式输出: 生成段落(长度=218)
2025-04-25 10:56:11,902 - DEBUG - 流式输出: 生成段落(长度=145)
2025-04-25 10:56:11,983 - DEBUG - 流式输出: 生成段落(长度=301)
2025-04-25 10:56:12,066 - DEBUG - 流式输出: 生成段落(长度=174)
2025-04-25 10:56:12,146 - DEBUG - 流式输出: 生成段落(长度=279)
2025-04-25 10:56:12,228 - DEBUG - 流式输出: 生成段落(长度=186)
2025-04-25 10:56:12,309 - DEBUG - 流式输出: 生成最后段落(长度=264)
2025-04-25 10:56:12,310 - DEBUG - 流式输出完成，使用markdown渲染最终内容
2025-04-25 10:56:12,310 - DEBUG - 最终渲染: 使用完整格式化内容
2025-04-25 10:56:12,310 - DEBUG - 会话ID: 2911512629072
2025-04-25 10:56:12,311 - DEBUG - 会话中的消息数量: 13
2025-04-25 10:56:12,312 - DEBUG - 更新会话历史: 添加助手回复
2025-04-25 10:56:12,312 - DEBUG - 添加到历史的消息长度: 1573
2025-04-25 10:56:12,312 - DEBUG - 添加到历史的来源数量: 1
2025-04-25 10:56:12,312 - DEBUG - 更新前会话消息数量: 13
2025-04-25 10:56:12,312 - DEBUG - 会话更新完成，当前消息数: 14
2025-04-25 10:56:12,317 - DEBUG - 聊天会话已保存到: chat_history\chat_sessions_1745549772.json
2025-04-25 10:56:12,318 - DEBUG - 会话最后消息摘要: A. 说明  
(1) 在此情况下可能出现液压油溢出和过量加注：  
(a) 出发地与到达地之间存在较大环境温度变化。若在寒冷地点起飞前将液压油箱加满，返回温暖地点时油箱可能因热膨胀导致过量加注，引发...
2025-04-25 10:56:12,318 - WARNING - 消息 #5 可能缺少Markdown格式 (长度=1437)
2025-04-25 10:56:12,318 - WARNING - 消息 #7 可能缺少Markdown格式 (长度=1437)
2025-04-25 10:56:12,318 - WARNING - 检测到会话历史中存在格式不一致的消息
2025-04-25 10:56:17,619 - DEBUG - 聊天会话已保存到: chat_history\chat_sessions_1745549777.json
2025-04-25 10:56:17,842 - DEBUG - 开始显示历史消息: 消息数量=0
2025-04-25 10:56:19,332 - DEBUG - 聊天会话已保存到: chat_history\chat_sessions_1745549779.json
2025-04-25 10:56:19,530 - DEBUG - 开始显示历史消息: 消息数量=0
2025-04-25 10:56:21,590 - DEBUG - 开始显示历史消息: 消息数量=0
2025-04-25 11:03:25,435 - DEBUG - 开始显示历史消息: 消息数量=0
2025-04-25 11:03:25,440 - DEBUG - 聊天会话已保存到: chat_history\chat_sessions_1745550205.json
2025-04-25 11:03:25,744 - DEBUG - 开始翻译和格式化，目标语言: zh
2025-04-25 11:03:25,745 - DEBUG - 原始文本长度: 1437
2025-04-25 11:03:25,745 - DEBUG - 简化后文本长度: 1437
2025-04-25 11:03:25,745 - DEBUG - 调用DeepSeek API进行翻译
2025-04-25 11:03:25,749 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': "You are a professional aircraft maintenance document translator.\n\n                    Keep the translation simple and directly usable:\n                    1. Maintain paragraph structure but don't worry about complex markdown\n                    2. Only use ** for important warnings or critical information\n                    3. Keep technical terms in their original form, especially:\n                       - System names like CDS, BITE, DEU, CPU \n                       - Error codes like 2075 00 11\n                       - Task numbers like 31-62-801"}, {'role': 'user', 'content': 'Translate this aircraft maintenance text from English to 中文.\n\n                    IMPORTANT: Keep all technical terms, numbers, error codes and task references in their original form.\n\n                    Text to translate:\n                    A. Description\n(1) This fault isolation procedure is used to find if the hydraulic system is in good condition. It will\nhelp you to find which parts are worn.\n(2) You can use this procedure to find if the parts have too much external leakage or the general\ninternal condition of the hydraulic system. You can also use it for trouble shooting the system.\n(a) When you are trouble-shooting the hydraulic system, it is only necessary for you to do\nthese procedures for the system (A, B, or standby) with the problem. When you can, use\nstandard tools to measure heat, vibration, or sound. Before you get near parts that move,\noperate them to make sure they can not hit you.\nB. Possible Causes\n(1) Damage or worn parts\nC. Fault Isolation Procedure\n(1) Do a hydraulic system external leakage check. To do it, do this task: Hydraulic System External\nLeakage Check, AMM TASK 29-00-00-790-801.\nNOTE: You can feel for hot tubes or actuators, or listen for fluid leaks to find which parts have\nthe problem.\n(a) If the hydraulic fluid leakage rate is more than the external leakage limits, then repair the\ncause of the leak (AMM TASK 29-00-00-790-801).\n(b) If the hydraulic fluid leakage rate is not more than the external leakage limits, then\ncontinue.\n(2) Do a hydraulic system internal leakage check (AMM PAGEBLOCK 29-00-00/601).\n(a) If the hydraulic fluid leakage rate is more than the internal leakage limits, then repair the\ncause of the leak.'}], 'model': 'deepseek-chat', 'max_tokens': 2000, 'temperature': 0.1}}
2025-04-25 11:03:25,787 - DEBUG - connect_tcp.started host='127.0.0.1' port=7890 local_address=None timeout=5.0 socket_options=None
2025-04-25 11:03:25,787 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002A5A43C88F0>
2025-04-25 11:03:25,788 - DEBUG - send_request_headers.started request=<Request [b'CONNECT']>
2025-04-25 11:03:25,788 - DEBUG - send_request_headers.complete
2025-04-25 11:03:25,788 - DEBUG - send_request_body.started request=<Request [b'CONNECT']>
2025-04-25 11:03:25,788 - DEBUG - send_request_body.complete
2025-04-25 11:03:25,789 - DEBUG - receive_response_headers.started request=<Request [b'CONNECT']>
2025-04-25 11:03:25,789 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'Connection established', [])
2025-04-25 11:03:25,789 - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000002A5A43C1DD0> server_hostname='api.deepseek.com' timeout=5.0
2025-04-25 11:03:25,910 - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002A5A43C8140>
2025-04-25 11:03:25,910 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-25 11:03:25,910 - DEBUG - send_request_headers.complete
2025-04-25 11:03:25,910 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-25 11:03:25,910 - DEBUG - send_request_body.complete
2025-04-25 11:03:25,910 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-25 11:03:25,976 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 25 Apr 2025 03:03:16 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'Set-Cookie', b'HWWAFSESID=76d7a7390d4367eb3c3; path=/'), (b'Set-Cookie', b'HWWAFSESTIME=1745550192418; path=/'), (b'vary', b'origin, access-control-request-method, access-control-request-headers'), (b'access-control-allow-credentials', b'true'), (b'x-ds-trace-id', b'aaf7872bad63f2432b27200e51580d20'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Content-Encoding', b'gzip'), (b'Server', b'elb')])
2025-04-25 11:03:25,977 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-04-25 11:03:25,977 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-04-25 11:03:42,551 - DEBUG - receive_response_body.complete
2025-04-25 11:03:42,551 - DEBUG - response_closed.started
2025-04-25 11:03:42,551 - DEBUG - response_closed.complete
2025-04-25 11:03:42,551 - DEBUG - HTTP Request: POST https://api.deepseek.com/chat/completions "200 OK"
2025-04-25 11:03:42,553 - DEBUG - 翻译完成，文本长度: 532
2025-04-25 11:03:42,554 - DEBUG - 从RAG pipeline获取的原始响应长度: 532
2025-04-25 11:03:42,554 - DEBUG - 响应前100字符: A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助确定哪些部件存在磨损。  
(2) 此程序可用于检查部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。 ...
2025-04-25 11:03:42,554 - DEBUG - 响应包含Markdown格式检查: False
2025-04-25 11:03:42,555 - DEBUG - 响应原始内容:
A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助确定哪些部件存在磨损。  
(2) 此程序可用于检查部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a) 对液压系统进行排故时，只需针对存在问题的系统（A系统、B系统或备用系统）执行相关程序。如条件允许，应使用标准工具测量温度、振动或噪音。在接近运动部件前，需先操作确认其不会造成伤害。  

B. 可能原因  
(1) 部件损坏或磨损  

C. 故障隔离程序  
(1) 执行液压系统外部泄漏检查，具体操作参见AMM TASK 29-00-00-790-801。  
**注：** 可通过触摸管路/作动筒温度或听液体泄漏声来定位故障部件。  
(a) 若液压油泄漏率超出外部泄漏限制，则需修复泄漏原因（AMM TASK 29-00-00-790-801）。  
(b) 若液压油泄漏率未超限，则继续后续检查。  

(2) 执行液压系统内部泄漏检查（AMM PAGEBLOCK 29-00-00/601）。  
(a) 若液压油泄漏率超出内部泄漏限制，则需修复泄漏原因。  

（注：严格保留AMM任务编号、系统代号等专有名词原文，关键操作步骤加粗提示）
2025-04-25 11:03:42,555 - WARNING - 响应可能缺少Markdown格式，尝试增强格式化
2025-04-25 11:03:42,555 - DEBUG - 增强格式化后的文本: A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助确定哪些部件存在磨损。  
(2) 此程序可用于检查部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。 ...
2025-04-25 11:03:42,555 - DEBUG - 检索到 1 个来源文档
2025-04-25 11:03:42,555 - DEBUG - 预处理前的原始Markdown文本长度: 532
2025-04-25 11:03:42,555 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助确定哪些部件存在磨损。  
(2) 此程序可用于检查部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a) 对液压系统进行排故时，只需针对存在问题的系统（A系统、B系统或备用系统）执行相关程序。如...
...
。  
(b) 若液压油泄漏率未超限，则继续后续检查。  

(2) 执行液压系统内部泄漏检查（AMM PAGEBLOCK 29-00-00/601）。  
(a) 若液压油泄漏率超出内部泄漏限制，则需修复泄漏原因。  

（注：严格保留AMM任务编号、系统代号等专有名词原文，关键操作步骤加粗提示）
2025-04-25 11:03:42,555 - DEBUG - 预处理后的文本长度: 532
2025-04-25 11:03:42,555 - DEBUG - Markdown元素检查: 标题=False, 代码=False, 列表=False
2025-04-25 11:03:42,556 - DEBUG - 支持write_stream流式输出: True
2025-04-25 11:03:42,556 - DEBUG - 开始流式输出...
2025-04-25 11:03:42,556 - DEBUG - 流式输出: 总行数 = 18
2025-04-25 11:03:42,556 - DEBUG - 流式输出: 生成段落(长度=198)
2025-04-25 11:03:42,638 - DEBUG - 流式输出: 生成段落(长度=24)
2025-04-25 11:03:42,721 - DEBUG - 流式输出: 在行 10 检测到段落边界: **注：** 可通过触摸管路/作动筒温度或听液体泄漏声来定位故障部件。  
2025-04-25 11:03:42,721 - DEBUG - 流式输出: 生成段落(长度=64)
2025-04-25 11:03:42,803 - DEBUG - 流式输出: 生成段落(长度=122)
2025-04-25 11:03:42,884 - DEBUG - 流式输出: 生成段落(长度=80)
2025-04-25 11:03:42,967 - DEBUG - 流式输出: 生成最后段落(长度=39)
2025-04-25 11:03:42,970 - DEBUG - 流式输出完成，使用markdown渲染最终内容
2025-04-25 11:03:42,972 - DEBUG - 最终渲染: 使用完整格式化内容
2025-04-25 11:03:42,973 - DEBUG - 会话ID: 2911512629072
2025-04-25 11:03:42,973 - DEBUG - 会话中的消息数量: 1
2025-04-25 11:03:42,978 - DEBUG - 更新会话历史: 添加助手回复
2025-04-25 11:03:42,978 - DEBUG - 添加到历史的消息长度: 532
2025-04-25 11:03:42,978 - DEBUG - 添加到历史的来源数量: 1
2025-04-25 11:03:42,979 - DEBUG - 更新前会话消息数量: 1
2025-04-25 11:03:42,979 - DEBUG - 会话更新完成，当前消息数: 2
2025-04-25 11:03:42,984 - DEBUG - 聊天会话已保存到: chat_history\chat_sessions_1745550222.json
2025-04-25 11:03:42,985 - DEBUG - 会话最后消息摘要: A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助确定哪些部件存在磨损。  
(2) 此程序可用于检查部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。 ...
2025-04-25 11:03:42,985 - DEBUG - 会话历史中的所有消息格式一致
2025-04-25 11:04:40,752 - DEBUG - 开始显示历史消息: 消息数量=2
2025-04-25 11:04:40,753 - DEBUG - 显示历史消息: 角色=user
2025-04-25 11:04:40,753 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 11:04:40,754 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 11:04:40,757 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 11:04:40,757 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 11:04:40,757 - DEBUG - 预处理前的原始Markdown文本长度: 532
2025-04-25 11:04:40,758 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助确定哪些部件存在磨损。  
(2) 此程序可用于检查部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a) 对液压系统进行排故时，只需针对存在问题的系统（A系统、B系统或备用系统）执行相关程序。如...
...
。  
(b) 若液压油泄漏率未超限，则继续后续检查。  

(2) 执行液压系统内部泄漏检查（AMM PAGEBLOCK 29-00-00/601）。  
(a) 若液压油泄漏率超出内部泄漏限制，则需修复泄漏原因。  

（注：严格保留AMM任务编号、系统代号等专有名词原文，关键操作步骤加粗提示）
2025-04-25 11:04:40,758 - DEBUG - 预处理后的文本长度: 532
2025-04-25 11:04:40,758 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=532, 新长度=532)
2025-04-25 11:04:40,758 - WARNING - 历史消息可能缺少Markdown格式: A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助确定哪些部件存在磨损。  
(2) 此程序可用于检查部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。 ...
2025-04-25 11:04:40,759 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 11:04:40,760 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 11:04:40,783 - DEBUG - 聊天会话已保存到: chat_history\chat_sessions_1745550280.json
2025-04-25 11:04:41,281 - DEBUG - 开始翻译和格式化，目标语言: en
2025-04-25 11:04:41,281 - DEBUG - 原始文本长度: 1437
2025-04-25 11:04:41,281 - DEBUG - 目标语言是英文，跳过翻译，只进行简单格式化
2025-04-25 11:04:41,281 - DEBUG - 英文结果格式化完成，长度: 1437
2025-04-25 11:04:41,283 - DEBUG - 从RAG pipeline获取的原始响应长度: 1437
2025-04-25 11:04:41,283 - DEBUG - 响应前100字符: A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good...
2025-04-25 11:04:41,283 - DEBUG - 响应包含Markdown格式检查: False
2025-04-25 11:04:41,283 - DEBUG - 响应原始内容:
A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good condition. It will
help you to find which parts are worn.
(2) You can use this procedure to find if the parts have too much external leakage or the general
internal condition of the hydraulic system. You can also use it for trouble shooting the system.
(a) When you are trouble-shooting the hydraulic system, it is only necessary for you to do
these procedures for the system (A, B, or standby) with the problem. When you can, use
standard tools to measure heat, vibration, or sound. Before you get near parts that move,
operate them to make sure they can not hit you.
B. Possible Causes
(1) Damage or worn parts
C. Fault Isolation Procedure
(1) Do a hydraulic system external leakage check. To do it, do this task: Hydraulic System External
Leakage Check, AMM TASK 29-00-00-790-801.
NOTE: You can feel for hot tubes or actuators, or listen for fluid leaks to find which parts have
the problem.
(a) If the hydraulic fluid leakage rate is more than the external leakage limits, then repair the
cause of the leak (AMM TASK 29-00-00-790-801).
(b) If the hydraulic fluid leakage rate is not more than the external leakage limits, then
continue.
(2) Do a hydraulic system internal leakage check (AMM PAGEBLOCK 29-00-00/601).
(a) If the hydraulic fluid leakage rate is more than the internal leakage limits, then repair the
cause of the leak.
2025-04-25 11:04:41,283 - WARNING - 响应可能缺少Markdown格式，尝试增强格式化
2025-04-25 11:04:41,283 - DEBUG - 增强格式化后的文本: A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good...
2025-04-25 11:04:41,283 - DEBUG - 检索到 1 个来源文档
2025-04-25 11:04:41,284 - DEBUG - 预处理前的原始Markdown文本长度: 1437
2025-04-25 11:04:41,284 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good condition. It will
help you to find which parts a...
...
eck (AMM PAGEBLOCK 29-00-00/601).
(a) If the hydraulic fluid leakage rate is more than the internal leakage limits, then repair the
cause of the leak.
2025-04-25 11:04:41,284 - DEBUG - 预处理后的文本长度: 1437
2025-04-25 11:04:41,284 - DEBUG - Markdown元素检查: 标题=False, 代码=False, 列表=False
2025-04-25 11:04:41,284 - DEBUG - 支持write_stream流式输出: True
2025-04-25 11:04:41,284 - DEBUG - 开始流式输出...
2025-04-25 11:04:41,284 - DEBUG - 流式输出: 总行数 = 23
2025-04-25 11:04:41,285 - DEBUG - 流式输出: 生成最后段落(长度=1437)
2025-04-25 11:04:41,286 - DEBUG - 流式输出完成，使用markdown渲染最终内容
2025-04-25 11:04:41,286 - DEBUG - 最终渲染: 使用完整格式化内容
2025-04-25 11:04:41,287 - DEBUG - 会话ID: 2911512629072
2025-04-25 11:04:41,287 - DEBUG - 会话中的消息数量: 3
2025-04-25 11:04:41,290 - DEBUG - 更新会话历史: 添加助手回复
2025-04-25 11:04:41,290 - DEBUG - 添加到历史的消息长度: 1437
2025-04-25 11:04:41,290 - DEBUG - 添加到历史的来源数量: 1
2025-04-25 11:04:41,290 - DEBUG - 更新前会话消息数量: 3
2025-04-25 11:04:41,290 - DEBUG - 会话更新完成，当前消息数: 4
2025-04-25 11:04:41,294 - DEBUG - 聊天会话已保存到: chat_history\chat_sessions_1745550281.json
2025-04-25 11:04:41,294 - DEBUG - 会话最后消息摘要: A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good...
2025-04-25 11:04:41,294 - WARNING - 消息 #3 可能缺少Markdown格式 (长度=1437)
2025-04-25 11:04:41,294 - WARNING - 检测到会话历史中存在格式不一致的消息
2025-04-25 11:04:54,900 - DEBUG - 开始显示历史消息: 消息数量=4
2025-04-25 11:04:54,901 - DEBUG - 显示历史消息: 角色=user
2025-04-25 11:04:54,901 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 11:04:54,901 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 11:04:54,902 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 11:04:54,902 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 11:04:54,902 - DEBUG - 预处理前的原始Markdown文本长度: 532
2025-04-25 11:04:54,902 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助确定哪些部件存在磨损。  
(2) 此程序可用于检查部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。  
(a) 对液压系统进行排故时，只需针对存在问题的系统（A系统、B系统或备用系统）执行相关程序。如...
...
。  
(b) 若液压油泄漏率未超限，则继续后续检查。  

(2) 执行液压系统内部泄漏检查（AMM PAGEBLOCK 29-00-00/601）。  
(a) 若液压油泄漏率超出内部泄漏限制，则需修复泄漏原因。  

（注：严格保留AMM任务编号、系统代号等专有名词原文，关键操作步骤加粗提示）
2025-04-25 11:04:54,902 - DEBUG - 预处理后的文本长度: 532
2025-04-25 11:04:54,902 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=532, 新长度=532)
2025-04-25 11:04:54,903 - WARNING - 历史消息可能缺少Markdown格式: A. 说明  
(1) 本故障隔离程序用于检查液压系统是否处于良好状态，可帮助确定哪些部件存在磨损。  
(2) 此程序可用于检查部件是否存在过量外部泄漏或液压系统的整体内部状况，也可用于系统排故。 ...
2025-04-25 11:04:54,903 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 11:04:54,903 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 11:04:54,905 - DEBUG - 显示历史消息: 角色=user
2025-04-25 11:04:54,905 - DEBUG - 处理用户历史消息: 直接显示
2025-04-25 11:04:54,906 - DEBUG - 显示历史消息: 角色=assistant
2025-04-25 11:04:54,906 - DEBUG - 处理助手历史消息: 先预处理再显示
2025-04-25 11:04:54,907 - DEBUG - 历史消息原始Markdown分析: 标题=False, 代码块=False, 列表=False
2025-04-25 11:04:54,907 - DEBUG - 预处理前的原始Markdown文本长度: 1437
2025-04-25 11:04:54,907 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good condition. It will
help you to find which parts a...
...
eck (AMM PAGEBLOCK 29-00-00/601).
(a) If the hydraulic fluid leakage rate is more than the internal leakage limits, then repair the
cause of the leak.
2025-04-25 11:04:54,907 - DEBUG - 预处理后的文本长度: 1437
2025-04-25 11:04:54,907 - DEBUG - 历史消息格式化: 长度变化=0 (原长度=1437, 新长度=1437)
2025-04-25 11:04:54,907 - WARNING - 历史消息可能缺少Markdown格式: A. Description
(1) This fault isolation procedure is used to find if the hydraulic system is in good...
2025-04-25 11:04:54,908 - DEBUG - 历史消息渲染成功(使用unsafe_allow_html=True)
2025-04-25 11:04:54,908 - DEBUG - 处理历史消息来源: 来源数量=1
2025-04-25 11:04:54,915 - DEBUG - 聊天会话已保存到: chat_history\chat_sessions_1745550294.json
2025-04-25 11:04:55,002 - DEBUG - 开始翻译和格式化，目标语言: fr
2025-04-25 11:04:55,027 - DEBUG - 原始文本长度: 11380
2025-04-25 11:04:55,027 - DEBUG - 简化后文本长度: 11380
2025-04-25 11:04:55,028 - DEBUG - 调用DeepSeek API进行翻译
2025-04-25 11:04:55,030 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': "You are a professional aircraft maintenance document translator.\n\n                    Keep the translation simple and directly usable:\n                    1. Maintain paragraph structure but don't worry about complex markdown\n                    2. Only use ** for important warnings or critical information\n                    3. Keep technical terms in their original form, especially:\n                       - System names like CDS, BITE, DEU, CPU \n                       - Error codes like 2075 00 11\n                       - Task numbers like 31-62-801"}, {'role': 'user', 'content': 'Translate this aircraft maintenance text from English to French.\n\n                    IMPORTANT: Keep all technical terms, numbers, error codes and task references in their original form.\n\n                    Text to translate:\n                    A. Description\n(1) The standby hydraulic system electric motor-driven pump (EMDP) supplies hydraulic pressure\nto the standby hydraulic system.\n(2) The standby hydraulic system EMDP has an electric motor that mechanically connects to the\nEMDP. The motor operates with three-phase, 400 hertz, 115 VAC power.\n(3) The EMDP is rated at 4.2 gpm at 2700 psi. The standby hydraulic system EMDP is in the right\naft wing to body fairing.\nB. Possible Causes\n(1) Standby hydraulic pump relay, R643\n(2) Standby hydraulic System EMDP, M242\n(3) Flight controls panel, P5-3\n(4) Wiring problem\nC. Circuit Breakers\n(1) These are the primary circuit breakers related to the fault:\nF/O Electrical System Panel, P6-2\nRow Col Number Name\nC 11 C00362 FLIGHT CONT SHUTOFF VALVES STBY RUD\nPower Distribution Panel Number 2, P92\nRow Col Number Name\nF 2 C01449 STANDBY HYDRAULIC PUMP\nD. Related Data\n(1) (SSM 29-22-11)\n(2) (WDM 29-22-11)\nE. Initial Evaluation\n(1) Do this check of the standby hydraulic system EMDP, M242:\nWARNING\nMAKE SURE THAT PERSONS AND EQUIPMENT ARE CLEAR OF ALL\nCONTROL SURFACES BEFORE YOU SUPPLY HYDRAULIC POWER.\nAILERONS, RUDDERS, ELEVATORS, FLAPS, SPOILERS, SLATS, AND\nTHRUST REVERSERS CAN MOVE QUICKLY WHEN YOU SUPPLY\nHYDRAULIC POWER. THIS CAN CAUSE INJURY TO PERSONS AND\nDAMAGE TO EQUIPMENT.\n(a) Pressurize the standby hydraulic system. To pressurize it, do this task: Standby Hydraulic\nSystem Pressurization, AMM TASK 29-21-00-000-801.\n(b) If the standby hydraulic system EMDP does not operate, then do the Manual Mode Fault\nIsolation Procedure below.\n(c) If the standby hydraulic system EMDP operates, then continue with the initial evaluation.\n(2) Do these steps to check the automatic operation of the standby hydraulic system EMDP:\n(a) Do this task to extend the Trailing Edge Flaps: Extend the Trailing Edge Flaps, AMM\nTASK 27-51-00-860-803\nNOTE: The position of the flaps is not important as long as they are extended.\n(b) Do this task: Standby Hydraulic System Power Removal, AMM TASK 29-21-00-000-802.\n(c) Do this task to put the airplane in air mode:\nPut the Airplane in the Air Mode, AMM TASK 32-09-00-860-801\n(d) Put the System A Flight Control Switch on the Flight Controls Panel, P5-3, to the ON\nposition.\n(e) Put the System B Flight Control Switch on the Flight Controls Panel, P5-3, to the ON\nposition.\n(f) Put the Alternate Flaps Switch on the Flight Controls Panel, P5-3, to the OFF position.\n(3) If the standby hydraulic system EMDP operates, then there was an intermittent fault. Do this\ntask to put the airplane back to its usual condition:\nReturn the Airplane Systems Back to Their Normal On Ground Condition, AMM\nTASK 32-09-00-840-802\n(4) If the standby hydraulic system EMDP does not operate, then do the Automatic Mode Fault\nIsolation Procedure below.\nF. Manual Mode Fault Isolation Procedure\n(1) Do a check of the standby hydraulic system EMDP, M242:\n(a) Disconnect connector D812 from the standby hydraulic system EMDP, M242.\n(b) Do a check for 115 VAC from pins A, B, and C of connector D812 to structure ground\n(WDM 29-22-11).\n(c) If there is 115 VAC at pins A, B, and C of connector D812, then do these steps:\n1) Replace the standby hydraulic system EMDP, M242. These are the tasks:\n\u2022 Standby Hydraulic System Electric Motor-Driven Pump (EMDP) Removal, AMM\nTASK 29-21-21-000-801\n\u2022 Standby Hydraulic System Electric Motor-Driven Pump (EMDP) Installation, AMM\nTASK 29-21-21-400-801\n2) Do the Repair Confirmation at the end of this task.\n(d) If there is not 115 VAC at pin A, B, or C of connector D812, then do these steps:\n1) Re-connect connector D812.\n2) Replace the standby hydraulic pump relay, R643 in the power distribution panel 2,\nP92.\nNOTE: The power distribution panel 2, P92, is in the electrical/electronic\ncompartment.\n3) Do the Repair Confirmation at the end of this task.\n4) If the Repair Confirmation is not satisfactory, then continue.\n5) Disconnect connector D11740 from the power distribution panel, P92.\n6) Disconnect connector D812 from the standby hydraulic system EMDP, M242.\n7) Do a wiring check between these pins of connector D812 at the standby hydraulic\nsystem EMDP, M242 and connector D11740 at the panel P92 (WDM 29-22-11):\nNOTE: You only need to do the wiring check at the pin that does not have 115 VAC.\nD812 D11740\npin A . . . . . . . . . . . . . . . . . . . pin A\npin B . . . . . . . . . . . . . . . . . . . pin B\npin C . . . . . . . . . . . . . . . . . . . pin C\n8) If you find a problem with the wiring, then do these steps:\na) Repair the wiring.\nb) Re-connect connector D812.\nc) Re-connect connector D11740.\nd) Do the Repair Confirmation at the end of this task.\n(e) If there is not 115 VAC at pins A, B, and C of connector D812, then continue.\n1) Re-connect connector D812.\n2) Re-connect connector D11740.\n(2) Do this wiring check of the standby hydraulic pump relay, R643:\n(a) Disconnect connector D11448 from the power distribution panel, P92.\nNOTE: The power distribution panel, P92 is in the electrical/electronic compartment.\n(b) Do a check for 28 VDC at pin 25 of connector D11448 to structure ground (WDM\n29-22-11).\n(c) If there is 28 VDC at pin 25 of connector D11448, then do these steps:\n1) Replace the standby hydraulic pump relay, R643 in the power distribution panel,\nP92.\n2) Re-connect connector D11448.\n3) Do the Repair Confirmation at the end of this task.\n4) If the Repair Confirmation is not satisfactory, then continue.\n5) Do a check for 115 VAC from the load terminal of this circuit breaker, C1449, to\nstructure ground (WDM 29-22-11):\na) This is the circuit breaker:\nPower Distribution Panel Number 2, P92\nRow Col Number Name\nF 2 C01449 STANDBY HYDRAULIC PUMP\n6) If there is not 115 VAC at circuit breaker, C1449, then do these steps:\na) Replace the circuit breaker, C1449.\nb) Do the Repair Confirmation at the end of this task.\n(d) If there is not 28 VDC at pin 25 of connector D11448, then continue.\n(3) Do this wiring check:\n(a) Remove the flight controls panel, P5-3. To remove it, do this task: Flight Controls Panel\nRemoval, AMM TASK 27-09-45-000-801\n(b) Disconnect connector D624 from the flight controls panel, P5-3.\n(c) Do a wiring check between these pins of connector D624 at the P5-3 panel and D11448\nat the panel P92 (WDM 29-22-11):\nD624 D11448\npin 21 . . . . . . . . . . . . . . . . . . . pin 25\n(d) If there is a problem with the wiring, then do these steps:\n1) Repair the wiring.\n2) Re-connect connector D11448.\n3) Re-connect connector D624.\n4) Re-install the flight controls panel, P5-3. To install it, do this task: Flight Controls\nPanel Installation, AMM TASK 27-09-45-400-801.\n5) Do the Repair Confirmation at the end of this task.\n(e) If you do not find a problem with the wiring, then continue.\n1) Re-connect connector D11448.\n(4) Do this check of the flight controls panel, P5-3:\n(a) Do a check for 28 VDC at pin 11 of connector D624 to structure ground (WDM 29-22-11).\n(b) If there is 28 VDC at pin 11 of connector D624, then do these steps:\n1) Install a new flight controls panel, P5-3. To install it, do this task: Flight Controls\nPanel Installation, AMM TASK 27-09-45-400-801.\n2) Do the Repair Confirmation at the end of this task.\n(c) If there is not 28 VDC at pin 11 of connector D624, then continue.\n(5) Do this check of the circuit breaker, C362:\n(a) Do a check for 28 VDC from the load terminal of this circuit breaker, C362, to structure\nground (WDM 29-22-11):\n1) This is the circuit breaker:\nF/O Electrical System Panel, P6-2\nRow Col Number Name\nC 11 C00362 FLIGHT CONT SHUTOFF VALVES STBY RUD\n(b) If there is not 28 VDC at circuit breaker, C362, then do these steps:\n1) Replace the circuit breaker, C362.\n2) Re-connect connector D624.\n3) Re-install the flight controls panel, P5-3. To install it, do this task: Flight Controls\nPanel Installation, AMM TASK 27-09-45-400-801.\n4) Do the Repair Confirmation at the end of this task.\n(c) If there is 28 VDC at circuit breaker, C362, then do these steps:\n1) Repair the wiring between pin 11 of connector D624 at the panel P5-3 to the load\nterminal of circuit breaker C362 at panel P6 (WDM 29-22-11).\n2) Re-connect connector D624.\n3) Re-install the flight controls panel, P5-3. To install it, do this task: Flight Controls\nPanel Installation, AMM TASK 27-09-45-400-801.\n4) Do the Repair Confirmation at the end of this task.\nG. Automatic Mode Fault Isolation Procedure\n(1) Do these steps to prepare the airplane for the following check:\n(a) If the flaps are not extended, then do this task to extend the Trailing Edge Flaps: Extend\nthe Trailing Edge Flaps, AMM TASK 27-51-00-860-803\nNOTE: The position of the flaps is not important as long as they are extended.\n(b) Do this task: Standby Hydraulic System Power Removal, AMM TASK 29-21-00-000-802.\n(c) Do this task to put the airplane in air mode:\nPut the Airplane in the Air Mode, AMM TASK 32-09-00-860-801\n(d) Put the System A Flight Control Switch on the Flight Controls Panel, P5-3, to the ON\nposition.\n(e) Put the System B Flight Control Switch on the Flight Controls Panel, P5-3, to the ON\nposition.\n(f) Put the Alternate Flaps Switch on the Flight Controls Panel, P5-3, to the OFF position.\n(2) With the airplane configured as shown above, do this wiring check of the Auto Standby Relay,\nK1, on the P5-3 Flight Control Panel:\n(a) Check the X2 pin of the Auto Standby Relay, K1, for continuity to ground.\n(b) If the X2 pin does have continuity to ground, then replace the Auto Standby Relay, K1.\n1) Do the Repair Confirmation at the end of this task.\n(c) If the X2 pin does not have continuity to ground, then repair the wiring as necessary.\n1) Do the Repair Confirmation at the end of this task.\nH. Repair Confirmation\n(1) Do this check of the standby hydraulic system EMDP, M242:\nWARNING\nMAKE SURE THAT PERSONS AND EQUIPMENT ARE CLEAR OF ALL\nCONTROL SURFACES BEFORE YOU SUPPLY HYDRAULIC POWER.\nAILERONS, RUDDERS, ELEVATORS, FLAPS, SPOILERS, SLATS, AND\nTHRUST REVERSERS CAN MOVE QUICKLY WHEN YOU SUPPLY\nHYDRAULIC POWER. THIS CAN CAUSE INJURY TO PERSONS AND\nDAMAGE TO EQUIPMENT.\n(a) Pressurize the standby hydraulic system. To pressurize it, do this task: Standby Hydraulic\nSystem Pressurization, AMM TASK 29-21-00-000-801.\n(2) Do this check of the automatic operation of the standby hydraulic system EMDP:\n(a) If the flaps are not extended, then do this task to extend the Trailing Edge Flaps: Extend\nthe Trailing Edge Flaps, AMM TASK 27-51-00-860-803\nNOTE: The position of the flaps is not important as long as they are extended.\n(b) Do this task: Standby Hydraulic System Power Removal, AMM TASK 29-21-00-000-802.\n(c) Do this task to put the airplane in air mode:\nPut the Airplane in the Air Mode, AMM TASK 32-09-00-860-801\n(d) Put the System A Flight Control Switch on the Flight Controls Panel, P5-3, to the ON\nposition.\n(e) Put the System B Flight Control Switch on the Flight Controls Panel, P5-3, to the ON\nposition.\n(f) Put the Alternate Flaps Switch on the Flight Controls Panel, P5-3, to the OFF position.\n(3) If the standby hydraulic system EMDP operates, then you corrected the fault.\nI. Put the Airplane Back to Its Usual Condition\n(1) Do this task to put the airplane in ground mode: Return the Airplane to the Ground Mode, AMM\nTASK 32-09-00-860-802.\n(2) Do this task to raise the trailing edge flaps: Retract the Trailing Edge Flaps, AMM\nTASK 27-51-00-860-804.\n(3) Do this task: Standby Hydraulic System Power Removal, AMM TASK 29-21-00-000-802.'}], 'model': 'deepseek-chat', 'max_tokens': 2000, 'temperature': 0.1}}
2025-04-25 11:04:55,032 - DEBUG - connect_tcp.started host='127.0.0.1' port=7890 local_address=None timeout=5.0 socket_options=None
2025-04-25 11:04:55,046 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002A63B6B02F0>
2025-04-25 11:04:55,046 - DEBUG - send_request_headers.started request=<Request [b'CONNECT']>
2025-04-25 11:04:55,046 - DEBUG - send_request_headers.complete
2025-04-25 11:04:55,046 - DEBUG - send_request_body.started request=<Request [b'CONNECT']>
2025-04-25 11:04:55,047 - DEBUG - send_request_body.complete
2025-04-25 11:04:55,047 - DEBUG - receive_response_headers.started request=<Request [b'CONNECT']>
2025-04-25 11:04:55,047 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'Connection established', [])
2025-04-25 11:04:55,047 - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000002A5A43C1DD0> server_hostname='api.deepseek.com' timeout=5.0
2025-04-25 11:04:55,155 - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002A63B6B0560>
2025-04-25 11:04:55,155 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-25 11:04:55,155 - DEBUG - send_request_headers.complete
2025-04-25 11:04:55,156 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-25 11:04:55,156 - DEBUG - send_request_body.complete
2025-04-25 11:04:55,156 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-25 11:04:55,250 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 25 Apr 2025 03:04:46 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'vary', b'origin, access-control-request-method, access-control-request-headers'), (b'access-control-allow-credentials', b'true'), (b'x-ds-trace-id', b'37dafb4678cc7f8b316028c8123e3a24'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Content-Encoding', b'gzip'), (b'Server', b'elb')])
2025-04-25 11:04:55,250 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-04-25 11:04:55,250 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-04-25 11:06:13,343 - DEBUG - receive_response_body.complete
2025-04-25 11:06:13,343 - DEBUG - response_closed.started
2025-04-25 11:06:13,343 - DEBUG - response_closed.complete
2025-04-25 11:06:13,343 - DEBUG - HTTP Request: POST https://api.deepseek.com/chat/completions "200 OK"
2025-04-25 11:06:13,345 - DEBUG - 翻译完成，文本长度: 5913
2025-04-25 11:06:13,346 - DEBUG - 从RAG pipeline获取的原始响应长度: 5913
2025-04-25 11:06:13,347 - DEBUG - 响应前100字符: A. Description  
(1) La pompe électrique du système hydraulique de secours (EMDP) fournit la pressio...
2025-04-25 11:06:13,347 - DEBUG - 响应包含Markdown格式检查: False
2025-04-25 11:06:13,347 - DEBUG - 响应原始内容:
A. Description  
(1) La pompe électrique du système hydraulique de secours (EMDP) fournit la pression hydraulique au système hydraulique de secours.  
(2) L'EMDP du système hydraulique de secours possède un moteur électrique relié mécaniquement à la pompe. Le moteur fonctionne avec une alimentation triphasée de 400 Hz, 115 VAC.  
(3) L'EMDP a une capacité de 4,2 gpm à 2700 psi. L'EMDP du système hydraulique de secours se trouve dans le carénage arrière droit entre l'aile et le fuselage.  

B. Causes possibles  
(1) Relais de la pompe hydraulique de secours, R643  
(2) EMDP du système hydraulique de secours, M242  
(3) Panneau des commandes de vol, P5-3  
(4) Problème de c\xe2blage  

C. Disjoncteurs  
(1) Voici les disjoncteurs principaux liés à la panne :  
F/O Electrical System Panel, P6-2  
Row Col Number Name  
C 11 C00362 FLIGHT CONT SHUTOFF VALVES STBY RUD  
Power Distribution Panel Number 2, P92  
Row Col Number Name  
F 2 C01449 STANDBY HYDRAULIC PUMP  

D. Données associées  
(1) (SSM 29-22-11)  
(2) (WDM 29-22-11)  

E. \xc9valuation initiale  
(1) Effectuez cette vérification de l'EMDP du système hydraulique de secours, M242 :  
**AVERTISSEMENT**  
**ASSUREZ-VOUS QUE LE PERSONNEL ET L'\xc9QUIPEMENT SONT \xc9LOIGN\xc9S DE TOUTES LES SURFACES DE COMMANDE AVANT D'ALIMENTER LE SYST\xc8ME HYDRAULIQUE.**  
**LES AILERONS, GOUVERNES, ASCENSEURS, VOLETS, SPOILERS, BECQUES ET INVERSEURS PEUVENT SE D\xc9PLACER RAPIDEMENT LORS DE L'ALIMENTATION HYDRAULIQUE. CELA PEUT CAUSER DES BLESSURES OU ENDOMMAGER L'\xc9QUIPEMENT.**  
(a) Mettez sous pression le système hydraulique de secours. Pour ce faire, exécutez cette t\xe2che : Pressurisation du système hydraulique de secours, AMM TASK 29-21-00-000-801.  
(b) Si l'EMDP du système hydraulique de secours ne fonctionne pas, effectuez la procédure d'isolement des pannes en mode manuel ci-dessous.  
(c) Si l'EMDP fonctionne, poursuivez l'évaluation initiale.  

(2) Effectuez ces étapes pour vérifier le fonctionnement automatique de l'EMDP du système hydraulique de secours :  
(a) Exécutez cette t\xe2che pour déployer les volets de bord de fuite : Déploiement des volets de bord de fuite, AMM TASK 27-51-00-860-803.  
**NOTE : La position des volets n'a pas d'importance tant qu'ils sont déployés.**  
(b) Exécutez cette t\xe2che : Coupure d'alimentation du système hydraulique de secours, AMM TASK 29-21-00-000-802.  
(c) Exécutez cette t\xe2che pour mettre l'avion en mode air :  
Mise en mode air de l'avion, AMM TASK 32-09-00-860-801.  
(d) Placez le commutateur Système A sur le panneau des commandes de vol, P5-3, en position ON.  
(e) Placez le commutateur Système B sur le panneau des commandes de vol, P5-3, en position ON.  
(f) Placez le commutateur Alternate Flaps sur le panneau des commandes de vol, P5-3, en position OFF.  

(3) Si l'EMDP du système hydraulique de secours fonctionne, il s'agissait d'une panne intermittente. Exécutez cette t\xe2che pour rétablir les conditions normales de l'avion :  
Retour aux conditions normales au sol des systèmes de l'avion, AMM TASK 32-09-00-840-802.  

(4) Si l'EMDP ne fonctionne pas, effectuez la procédure d'isolement des pannes en mode automatique ci-dessous.  

F. Procédure d'isolement des pannes en mode manuel  
(1) Vérifiez l'EMDP du système hydraulique de secours, M242 :  
(a) Débranchez le connecteur D812 de l'EMDP, M242.  
(b) Vérifiez la présence de 115 VAC entre les broches A, B et C du connecteur D812 et la masse (WDM 29-22-11).  
(c) Si 115 VAC est présent aux broches A, B et C du connecteur D812, effectuez ces étapes :  
1) Remplacez l'EMDP du système hydraulique de secours, M242. Voici les t\xe2ches :  
\u2022 Démontage de l'EMDP du système hydraulique de secours, AMM TASK 29-21-21-000-801.  
\u2022 Installation de l'EMDP du système hydraulique de secours, AMM TASK 29-21-21-400-801.  
2) Effectuez la confirmation de réparation à la fin de cette t\xe2che.  

(d) Si 115 VAC est absent sur une ou plusieurs broches du connecteur D812, effectuez ces étapes :  
1) Rebranchez le connecteur D812.  
2) Remplacez le relais de la pompe hydraulique de secours, R643, dans le panneau de distribution d'alimentation 2, P92.  
**NOTE : Le panneau P92 se trouve dans le compartiment électrique/électronique.**  
3) Effectuez la confirmation de réparation à la fin de cette t\xe2che.  
4) Si la confirmation n'est pas satisfaisante, poursuivez.  
5) Débranchez le connecteur D11740 du panneau P92.  
6) Débranchez le connecteur D812 de l'EMDP, M242.  
7) Vérifiez le c\xe2blage entre les broches du connecteur D812 (EMDP) et D11740 (P92) (WDM 29-22-11) :  
**NOTE : Vérifiez uniquement la broche sans 115 VAC.**  
D812 D11740  
broche A . . . . . . . . . . . . . . . . . . . broche A  
broche B . . . . . . . . . . . . . . . . . . . broche B  
broche C . . . . . . . . . . . . . . . . . . . broche C  
8) Si un problème de c\xe2blage est détecté :  
a) Réparez le c\xe2blage.  
b) Rebranchez le connecteur D812.  
c) Rebranchez le connecteur D11740.  
d) Effectuez la confirmation de réparation.  

(e) Si 115 VAC est absent sur toutes les broches du connecteur D812, poursuivez.  
1) Rebranchez le connecteur D812.  
2) Rebranchez le connecteur D11740.  

(2) Vérifiez le c\xe2blage du relais de la pompe hydraulique de secours, R643 :  
(a) Débranchez le connecteur D11448 du panneau P92.  
**NOTE : Le panneau P92 se trouve dans le compartiment électrique/électronique.**  
(b) Vérifiez la présence de 28 VDC à la broche 25 du connecteur D11448 par rapport à la masse (WDM 29-22-11).  
(c) Si 28 VDC est présent :  
1) Remplacez le relais R643 dans le panneau P92.  
2) Rebranchez le connecteur D11448.  
3) Effectuez la confirmation de réparation.  
4) Si la confirmation n'est pas satisfaisante, poursuivez.  
5) Vérifiez la présence de 115 VAC au disjoncteur C1449 (WDM 29-22-11) :  
a) Disjoncteur concerné :  
Power Distribution Panel Number 2, P92  
Row Col Number Name  
F 2 C01449 STANDBY HYDRAULIC PUMP  
6) Si 115 VAC est
2025-04-25 11:06:13,347 - WARNING - 响应可能缺少Markdown格式，尝试增强格式化
2025-04-25 11:06:13,347 - DEBUG - 增强格式化后的文本: A. Description  
(1) La pompe électrique du système hydraulique de secours (EMDP) fournit la pressio...
2025-04-25 11:06:13,347 - DEBUG - 检索到 1 个来源文档
2025-04-25 11:06:13,348 - DEBUG - 预处理前的原始Markdown文本长度: 5913
2025-04-25 11:06:13,349 - DEBUG - 预处理前的原始Markdown文本 (截断):
A. Description  
(1) La pompe électrique du système hydraulique de secours (EMDP) fournit la pression hydraulique au système hydraulique de secours.  ...
...
) :  
a) Disjoncteur concerné :  
Power Distribution Panel Number 2, P92  
Row Col Number Name  
F 2 C01449 STANDBY HYDRAULIC PUMP  
6) Si 115 VAC est
2025-04-25 11:06:13,349 - DEBUG - 预处理后的文本长度: 5913
2025-04-25 11:06:13,349 - DEBUG - Markdown元素检查: 标题=False, 代码=False, 列表=False
2025-04-25 11:06:13,349 - DEBUG - 支持write_stream流式输出: True
2025-04-25 11:06:13,349 - DEBUG - 开始流式输出...
2025-04-25 11:06:13,349 - DEBUG - 流式输出: 总行数 = 97
2025-04-25 11:06:13,349 - DEBUG - 流式输出: 生成段落(长度=493)
2025-04-25 11:06:13,431 - DEBUG - 流式输出: 生成段落(长度=194)
2025-04-25 11:06:13,511 - DEBUG - 流式输出: 生成段落(长度=283)
2025-04-25 11:06:13,593 - DEBUG - 流式输出: 生成段落(长度=65)
2025-04-25 11:06:13,674 - DEBUG - 流式输出: 在行 26 检测到段落边界: **AVERTISSEMENT**  
2025-04-25 11:06:13,674 - DEBUG - 流式输出: 生成段落(长度=112)
2025-04-25 11:06:13,757 - DEBUG - 流式输出: 在行 27 检测到段落边界: **ASSUREZ-VOUS QUE LE PERSONNEL ET L'\xc9QUIPEMENT SONT \xc9LOIGN\xc9S DE TOUTES LES SURFACES DE COMMANDE AVANT D'ALIMENTER LE SYST\xc8ME HYDRAULIQUE.**  
2025-04-25 11:06:13,757 - DEBUG - 流式输出: 生成段落(长度=19)
2025-04-25 11:06:13,837 - DEBUG - 流式输出: 在行 28 检测到段落边界: **LES AILERONS, GOUVERNES, ASCENSEURS, VOLETS, SPOILERS, BECQUES ET INVERSEURS PEUVENT SE D\xc9PLACER RAPIDEMENT LORS DE L'ALIMENTATION HYDRAULIQUE. CELA PEUT CAUSER DES BLESSURES OU ENDOMMAGER L'\xc9QUIPEMENT.**  
2025-04-25 11:06:13,837 - DEBUG - 流式输出: 生成段落(长度=142)
2025-04-25 11:06:13,920 - DEBUG - 流式输出: 生成段落(长度=589)
2025-04-25 11:06:14,002 - DEBUG - 流式输出: 在行 35 检测到段落边界: **NOTE : La position des volets n'a pas d'importance tant qu'ils sont déployés.**  
2025-04-25 11:06:14,002 - DEBUG - 流式输出: 生成段落(长度=256)
2025-04-25 11:06:14,083 - DEBUG - 流式输出: 生成段落(长度=614)
2025-04-25 11:06:14,165 - DEBUG - 流式输出: 生成段落(长度=267)
2025-04-25 11:06:14,247 - DEBUG - 流式输出: 生成段落(长度=113)
2025-04-25 11:06:14,328 - DEBUG - 流式输出: 生成段落(长度=704)
2025-04-25 11:06:14,409 - DEBUG - 流式输出: 在行 61 检测到段落边界: **NOTE : Le panneau P92 se trouve dans le compartiment électrique/électronique.**  
2025-04-25 11:06:14,409 - DEBUG - 流式输出: 生成段落(长度=258)
2025-04-25 11:06:14,490 - DEBUG - 流式输出: 在行 67 检测到段落边界: **NOTE : Vérifiez uniquement la broche sans 115 VAC.**  
2025-04-25 11:06:14,491 - DEBUG - 流式输出: 生成段落(长度=421)
2025-04-25 11:06:14,575 - DEBUG - 流式输出: 生成段落(长度=434)
2025-04-25 11:06:14,656 - DEBUG - 流式输出: 生成段落(长度=157)
2025-04-25 11:06:14,737 - DEBUG - 流式输出: 在行 84 检测到段落边界: **NOTE : Le panneau P92 se trouve dans le compartiment électrique/électronique.**  
2025-04-25 11:06:14,737 - DEBUG - 流式输出: 生成段落(长度=133)
2025-04-25 11:06:14,820 - DEBUG - 流式输出: 生成最后段落(长度=641)
2025-04-25 11:06:14,822 - DEBUG - 流式输出完成，使用markdown渲染最终内容
2025-04-25 11:06:14,822 - DEBUG - 最终渲染: 使用完整格式化内容
2025-04-25 11:06:14,823 - DEBUG - 会话ID: 2911512629072
2025-04-25 11:06:14,823 - DEBUG - 会话中的消息数量: 5
2025-04-25 11:06:14,825 - DEBUG - 更新会话历史: 添加助手回复
2025-04-25 11:06:14,825 - DEBUG - 添加到历史的消息长度: 5913
2025-04-25 11:06:14,825 - DEBUG - 添加到历史的来源数量: 1
2025-04-25 11:06:14,825 - DEBUG - 更新前会话消息数量: 5
2025-04-25 11:06:14,825 - DEBUG - 会话更新完成，当前消息数: 6
2025-04-25 11:06:14,830 - DEBUG - 聊天会话已保存到: chat_history\chat_sessions_1745550374.json
2025-04-25 11:06:14,830 - DEBUG - 会话最后消息摘要: A. Description  
(1) La pompe électrique du système hydraulique de secours (EMDP) fournit la pressio...
2025-04-25 11:06:14,830 - WARNING - 消息 #3 可能缺少Markdown格式 (长度=1437)
2025-04-25 11:06:14,831 - WARNING - 检测到会话历史中存在格式不一致的消息
